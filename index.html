<!DOCTYPE>

<html>

  <head>
    <title>NGAC policy tool</title>

    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.0.3/css/font-awesome.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css" rel="stylesheet">
    <link href="cytoscape/css/cytoscape.js-panzoom.css" rel="stylesheet" type="text/css" />
    <link href="style.css" rel="stylesheet" type="text/css" />

    <script src="cytoscape/js/dependencies.js"></script>
    <script src="cytoscape/js/cytoscape.min.js"></script>
		<script src="cytoscape/js/cytoscape-extensions.js"></script>
    <script src="ngac.js"></script>


    <script>
      document.addEventListener('DOMContentLoaded', function(){

        var cy = window.cy = cytoscape({
          container: document.getElementById('cy'),

          ready: function(){
            this.layout({name: 'cose-bilkent', animationDuration: 1000}).run();
          },


          style: [
            {
              selector: 'node[name]',
              style: {
                'content': 'data(name)'
              }
            },

            {
              selector: 'edge',
              style: {
                'curve-style': 'bezier',
                'target-arrow-shape': 'triangle',
                'content': 'data(name)'
              }
            },

            {
              selector: '.object',
              style: {
                'shape': 'rectangle',
                'width': '50px'
              }
            },

            {
              "selector": ".edgelabel",
              "style": {
                "color": "#fff",
                "text-outline-color": "#888",
                "text-outline-width": 2,
                'font-size': '12px'
              }
            },

            // some style for the extension
            {
              selector: '.eh-handle',
              style: {
                'background-color': 'red',
                'width': 12,
                'height': 12,
                'shape': 'ellipse',
                'overlay-opacity': 0,
                'border-width': 12, // makes the handle easier to hit
                'border-opacity': 0
              }
            },

            {
              selector: '.eh-hover',
              style: {
                'background-color': 'red'
              }
            },

            {
              selector: '.eh-source',
              style: {
                'border-width': 2,
                'border-color': 'red'
              }
            },

            {
              selector: '.eh-target',
              style: {
                'border-width': 2,
                'border-color': 'red'
              }
            },

            {
              selector: '.eh-preview, .eh-ghost-edge',
              style: {
                'background-color': 'red',
                'line-color': 'red',
                'target-arrow-color': 'red',
                'source-arrow-color': 'red'
              }
            },
            {
              selector: '.eh-ghost-edge.eh-preview-active',
              style: {
                'opacity': 0
              }
            }
          ],
          elements: {
            nodes: [

              // Categories
              { data: { id: 'books', name: 'Books' } },

              { data: { id: 'docs', name: 'Documents' } },
              { data: { id: 'team', name: 'Team' } },
              { data: { id: 'lotr', name: 'Lord of the rings', parent: 'books' } },

              // Objects
              { data: { id: 'hobbit', name: 'The Hobbit', parent: 'books' }, classes: 'object' },
              { data: { id: 'fotr', name: 'Fellowship of the ring', parent: 'lotr' }, classes: 'object' },
              { data: { id: 'ttt', name: 'The Two Towers', parent: 'lotr' }, classes: 'object' },
              { data: { id: 'rotk', name: 'Return of the king', parent: 'lotr' }, classes: 'object' },
              { data: { id: 'secret', name: 'Secret Document', parent: 'docs' }, classes: 'object' },

              // Subjects
              { data: { id: 'ille', name: 'Ilaman', parent: 'team' }, classes: 'subject' },
              { data: { id: 'jeppe', name: 'Jesper', parent: 'team' }, classes: 'subject' },
              { data: { id: 'emil', name: 'Emil', parent: 'team' }, classes: 'subject' },
              { data: { id: 'birger', name: 'Birger', parent: 'team' }, classes: 'subject' }
            ],
            edges: [
              { data: { name: 'write', source: 'jeppe', target: 'fotr' }, classes: 'edgelabel' },
              { data: { id: 'test', name: 'read', source: 'ille', target: 'ttt' }, classes: 'edgelabel' },
              { data: { name: 'write', source: 'birger', target: 'secret' }, classes: 'edgelabel' },
              { data: { name: 'read', source: 'emil', target: 'rotk' }, classes: 'edgelabel' }
            ]
          }
        });


        var eh = cy.edgehandles({
        });

        document.querySelector('#draw-on').addEventListener('click', function() {
          eh.enableDrawMode();
          displayDrawMode();
        });

        document.querySelector('#draw-off').addEventListener('click', function() {
          eh.disableDrawMode();
          displayDrawMode();
        });

        document.querySelector('#delete-element').addEventListener('click', function() {
          deleteElement();
        });

        document.querySelector('#add-node').addEventListener('click', function() {
          addNode();
          var layout = cy.layout({
            name: 'cose-bilkent',
            animate: 'end',
            animationEasing: 'ease-out',
            animationDuration: 2000,
            randomize: true
          });

          layout.run();
        });

        cy.panzoom({
					// options here...
				});


      });

    </script>
  </head>

  <body>

    <div id="cy"></div>

    <div id="buttons" class="cy-panzoom">

      <button id="draw-off" class="drawoff"><i class="fas fa-expand-arrows-alt"></i></button>
      <button id="draw-on"><i class="fas fa-draw-polygon"></i></button>

      <button id="add-node"><i class="fas fa-plus"></i></button>
      <button id="delete-element"><i class="fas fa-trash-alt"></i></button>

    </div>

  </body>

</html>
